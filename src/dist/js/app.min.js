function NoInvestmentsException(e){this.name="NoInvestmentsException",this.message=e,this.stack=(new Error).stack}function NoTradersException(e){this.name="NoTradersException",this.message=e,this.stack=(new Error).stack}function NoUserException(e){this.name="NoUserException",this.message=e,this.stack=(new Error).stack}function Investment(e,t){this.trader=e,this.amount=t}function Position(e,t,r,n,s,o){this.traderId=e,this.datetime=t,this.stock=r,this.price=n,this["short"]=s,this.percentage=o}function Trader(e,t){this.name=e,this.positions=t}function User(e,t,r){this.name=e,this.available=t,this.investments=r}var config={url:"",localUrl:"http://localhost:63342/platform/src/data/demo.json"};NoInvestmentsException.prototype=Object.create(Error.prototype),NoInvestmentsException.prototype.constructor=NoInvestmentsException,NoTradersException.prototype=Object.create(Error.prototype),NoTradersException.prototype.constructor=NoTradersException,NoUserException.prototype=Object.create(Error.prototype),NoUserException.prototype.constructor=NoUserException;var formatMoney=function(e){return e.toLocaleString(void 0,{minimumFractionDigits:2})},PositionService=function(){"use strict";return{get:function(){var e=new XMLHttpRequest;if(e.open("GET",config.localUrl,!1),e.send(null),200===e.status){for(var t=JSON.parse(e.responseText),r=[],n=0,s=t.positions.length;s>n;n++){var o=t.positions[n],i=new Position(o.traderId,o.datetime,o.stock,o.price,o["short"],o.percentage);r.push(i)}return r}},getByTraderId:function(e){var t=new XMLHttpRequest;if(t.open("GET",config.localUrl,!1),t.send(null),200===t.status){for(var r=JSON.parse(t.responseText),n=[],s=0,o=r.positions.length;o>s;s++){var i=r.positions[s];if(i.traderId===e){var a=new Position(i.traderId,i.datetime,i.stock,i.price,i["short"],i.percentage);n.push(a)}}return n}}}}(),TraderService=function(){"use strict";return{get:function(){var e=new XMLHttpRequest;if(e.open("GET",config.localUrl,!1),e.send(null),200===e.status){for(var t=JSON.parse(e.responseText),r=[],n=0,s=t.traders.length;s>n;n++){var o=t.traders[n],i=PositionService.getByTraderId(o.id),a=new Trader(o.name,i);r.push(a)}return r}},getById:function(e){var t=new XMLHttpRequest;if(t.open("GET",config.localUrl,!1),t.send(null),200===t.status)for(var r=JSON.parse(t.responseText),n=0,s=r.traders.length;s>n;n++){var o=r.traders[n];if(o.id===e){var i=PositionService.getByTraderId(o.id);return new Trader(o.name,i)}}}}}(),UserService=function(){"use strict";return{get:function(){var e=new XMLHttpRequest;if(e.open("GET",config.localUrl,!1),e.send(null),200===e.status){for(var t=JSON.parse(e.responseText),r=[],n=0,s=t.user.investments.length;s>n;n++){var o=t.user.investments[n],i=TraderService.getById(o.traderId),a=new Investment(i,o.amount);r.push(a)}return new User(t.user.name,t.user.available,r)}}}}(),UserViewModel={user:null,render:function(e){if(!this.user||"object"!=typeof this.user)throw new NoUserException("No user set");var t=document.querySelector(e),r="<section class='img'></section>";r+="<h2>"+this.user.name+"</h2>",r+="<h3>&euro; "+formatMoney(this.user.available)+"</h3>";for(var n=0,s=0,o="",i=0,a=this.user.investments.length;a>i;i++){var c=this.user.investments[i];n+=c.amount,o+="<trader-profile><section class='img'></section>",o+="<h2>"+c.trader.name+"</h2>",o+="<h3>&euro; "+formatMoney(c.amount)+"</h3>",o+="<dl>";for(var d=0,p=0,u=c.trader.positions.length;u>p;p++){var l=c.trader.positions[p];d+=l.percentage}s+=c.amount/100*d,o+="<dt>Uninvested:</dt><dd><span>&euro;</span>"+formatMoney(c.amount/100*(100-d))+"</dd>",o+="<dt>Invested:</dt><dd><span>&euro;</span>"+formatMoney(c.amount/100*d)+"</dd>",o+="</trader-profile>"}r+="<dl>",r+="<dt>Available:</dt><dd><span>&euro;</span>"+formatMoney(this.user.available-n)+"</dd>",r+="<dt>Uninvested:</dt><dd><span>&euro;</span>"+formatMoney(this.user.available-(this.user.available-n)-s)+"</dd>",r+="<dt>Invested:</dt><dd><span>&euro;</span>"+formatMoney(s)+"</dd>",r+="</dl>",t.innerHTML=r+o}};!function(){UserViewModel.user=UserService.get(),UserViewModel.render("user-profile")}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk5vSW52ZXN0bWVudHNFeGNlcHRpb24uanMiLCJOb1RyYWRlcnNFeGNlcHRpb24uanMiLCJOb1VzZXJFeGNlcHRpb24uanMiLCJJbnZlc3RtZW50LmpzIiwiUG9zaXRpb24uanMiLCJUcmFkZXIuanMiLCJVc2VyLmpzIiwiY29uZmlnLmpzIiwiQ3VycmVuY3lTZXJ2aWNlLmpzIiwiUG9zaXRpb25TZXJ2aWNlLmpzIiwiVHJhZGVyU2VydmljZS5qcyIsIlVzZXJTZXJ2aWNlLmpzIiwiVXNlclZpZXdNb2RlbC5qcyIsImFwcC5qcyJdLCJuYW1lcyI6WyJOb0ludmVzdG1lbnRzRXhjZXB0aW9uIiwibWVzc2FnZSIsInRoaXMiLCJuYW1lIiwic3RhY2siLCJFcnJvciIsIk5vVHJhZGVyc0V4Y2VwdGlvbiIsIk5vVXNlckV4Y2VwdGlvbiIsIkludmVzdG1lbnQiLCJ0cmFkZXIiLCJhbW91bnQiLCJQb3NpdGlvbiIsInRyYWRlcklkIiwiZGF0ZXRpbWUiLCJzdG9jayIsInByaWNlIiwic2hvcnQiLCJwZXJjZW50YWdlIiwiVHJhZGVyIiwicG9zaXRpb25zIiwiVXNlciIsImF2YWlsYWJsZSIsImludmVzdG1lbnRzIiwiY29uZmlnIiwidXJsIiwibG9jYWxVcmwiLCJwcm90b3R5cGUiLCJPYmplY3QiLCJjcmVhdGUiLCJjb25zdHJ1Y3RvciIsImZvcm1hdE1vbmV5IiwibnVtYmVyIiwidG9Mb2NhbGVTdHJpbmciLCJ1bmRlZmluZWQiLCJtaW5pbXVtRnJhY3Rpb25EaWdpdHMiLCJQb3NpdGlvblNlcnZpY2UiLCJnZXQiLCJ4bWxIdHRwIiwiWE1MSHR0cFJlcXVlc3QiLCJvcGVuIiwic2VuZCIsInN0YXR1cyIsImRhdGEiLCJKU09OIiwicGFyc2UiLCJyZXNwb25zZVRleHQiLCJpIiwibCIsImxlbmd0aCIsIm8iLCJwb3NpdGlvbiIsInB1c2giLCJnZXRCeVRyYWRlcklkIiwiVHJhZGVyU2VydmljZSIsInRyYWRlcnMiLCJpZCIsInQiLCJnZXRCeUlkIiwiVXNlclNlcnZpY2UiLCJ1c2VyIiwiaW52ZXN0bWVudCIsIlVzZXJWaWV3TW9kZWwiLCJyZW5kZXIiLCJlbGVtZW50U2VsZWN0b3IiLCJlbGVtZW50IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiYm9iIiwiaW52ZXN0ZWQiLCJpbnN0b2NrIiwiYm9iZXR0ZSIsImoiLCJtIiwicCIsImlubmVySFRNTCJdLCJtYXBwaW5ncyI6IkFBQUEsUUFBQUEsd0JBQUFDLEdBRUFDLEtBQUFDLEtBQUEseUJBQ0FELEtBQUFELFFBQUFBLEVBQ0FDLEtBQUFFLE9BQUEsR0FBQUMsUUFBQUQsTUNKQSxRQUFBRSxvQkFBQUwsR0FFQUMsS0FBQUMsS0FBQSxxQkFDQUQsS0FBQUQsUUFBQUEsRUFDQUMsS0FBQUUsT0FBQSxHQUFBQyxRQUFBRCxNQ0pBLFFBQUFHLGlCQUFBTixHQUVBQyxLQUFBQyxLQUFBLGtCQUNBRCxLQUFBRCxRQUFBQSxFQUNBQyxLQUFBRSxPQUFBLEdBQUFDLFFBQUFELE1DSkEsUUFBQUksWUFBQUMsRUFBQUMsR0FDQVIsS0FBQU8sT0FBQUEsRUFDQVAsS0FBQVEsT0FBQUEsRUNGQSxRQUFBQyxVQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQUNBZixLQUFBVSxTQUFBQSxFQUNBVixLQUFBVyxTQUFBQSxFQUNBWCxLQUFBWSxNQUFBQSxFQUNBWixLQUFBYSxNQUFBQSxFQUNBYixLQUFBQSxTQUFBYyxFQUNBZCxLQUFBZSxXQUFBQSxFQ05BLFFBQUFDLFFBQUFmLEVBQUFnQixHQUNBakIsS0FBQUMsS0FBQUEsRUFDQUQsS0FBQWlCLFVBQUFBLEVDRkEsUUFBQUMsTUFBQWpCLEVBQUFrQixFQUFBQyxHQUNBcEIsS0FBQUMsS0FBQUEsRUFDQUQsS0FBQW1CLFVBQUFBLEVBQ0FuQixLQUFBb0IsWUFBQUEsRUNIQSxHQUFBQyxTQUVBQyxJQUFBLEdBQ0FDLFNBQUEscURQS0F6Qix3QkFBQTBCLFVBQUFDLE9BQUFDLE9BQUF2QixNQUFBcUIsV0FDQTFCLHVCQUFBMEIsVUFBQUcsWUFBQTdCLHVC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RUFDQXlELEVBQUEsRUFBQUMsRUFBQXZCLEVBQUF4QyxPQUFBVSxVQUFBNkIsT0FBQXdCLEVBQUFELEVBQUFBLElBQUEsQ0FDQSxHQUFBRSxHQUFBeEIsRUFBQXhDLE9BQUFVLFVBQUFvRCxFQUNBekQsSUFBQTJELEVBQUF4RCxXQUVBb0QsR0FBQXBCLEVBQUF2QyxPQUFBLElBQUFJLEVBQ0F3RCxHQUFBLDhDQUFBeEMsWUFBQW1CLEVBQUF2QyxPQUFBLEtBQUEsSUFBQUksSUFBQSxRQUNBd0QsR0FBQSw0Q0FBQXhDLFlBQUFtQixFQUFBdkMsT0FBQSxJQUFBSSxHQUFBLFFBQ0F3RCxHQUFBLG9CQUdBSCxHQUFBLE9BQ0FBLEdBQUEsNkNBQUFyQyxZQUFBNUIsS0FBQXlELEtBQUF0QyxVQUFBK0MsR0FBQSxRQUNBRCxHQUFBLDhDQUFBckMsWUFBQTVCLEtBQUF5RCxLQUFBdEMsV0FBQW5CLEtBQUF5RCxLQUFBdEMsVUFBQStDLEdBQUFDLEdBQUEsUUFDQUYsR0FBQSw0Q0FBQXJDLFlBQUF1QyxHQUFBLFFBQ0FGLEdBQUEsUUFFQUgsRUFBQVUsVUFBQVAsRUFBQUcsS0MxQ0EsV0FFQVQsY0FBQUYsS0FBQUQsWUFBQXRCLE1BQ0F5QixjQUFBQyxPQUFBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBOb0ludmVzdG1lbnRzRXhjZXB0aW9uKG1lc3NhZ2UpIHtcblxuICAgIHRoaXMubmFtZSA9IFwiTm9JbnZlc3RtZW50c0V4Y2VwdGlvblwiO1xuICAgIHRoaXMubWVzc2FnZSA9IG1lc3NhZ2U7XG4gICAgdGhpcy5zdGFjayA9IChuZXcgRXJyb3IoKSkuc3RhY2s7XG5cbn1cblxuTm9JbnZlc3RtZW50c0V4Y2VwdGlvbi5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEVycm9yLnByb3RvdHlwZSk7XG5Ob0ludmVzdG1lbnRzRXhjZXB0aW9uLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IE5vSW52ZXN0bWVudHNFeGNlcHRpb247IiwiZnVuY3Rpb24gTm9UcmFkZXJzRXhjZXB0aW9uKG1lc3NhZ2UpIHtcblxuICAgIHRoaXMubmFtZSA9IFwiTm9UcmFkZXJzRXhjZXB0aW9uXCI7XG4gICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTtcbiAgICB0aGlzLnN0YWNrID0gKG5ldyBFcnJvcigpKS5zdGFjaztcblxufVxuXG5Ob1RyYWRlcnNFeGNlcHRpb24ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShFcnJvci5wcm90b3R5cGUpO1xuTm9UcmFkZXJzRXhjZXB0aW9uLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IE5vVHJhZGVyc0V4Y2VwdGlvbjsiLCJmdW5jdGlvbiBOb1VzZXJFeGNlcHRpb24obWVzc2FnZSkge1xuXG4gICAgdGhpcy5uYW1lID0gXCJOb1VzZXJFeGNlcHRpb25cIjtcbiAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlO1xuICAgIHRoaXMuc3RhY2sgPSAobmV3IEVycm9yKCkpLnN0YWNrO1xuXG59XG5cbk5vVXNlckV4Y2VwdGlvbi5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEVycm9yLnByb3RvdHlwZSk7XG5Ob1VzZXJFeGNlcHRpb24ucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gTm9Vc2VyRXhjZXB0aW9uOyIsImZ1bmN0aW9uIEludmVzdG1lbnQodHJhZGVyLCBhbW91bnQpIHtcbiAgICB0aGlzLnRyYWRlciA9IHRyYWRlcjtcbiAgICB0aGlzLmFtb3VudCA9IGFtb3VudDtcbn0iLCJmdW5jdGlvbiBQb3NpdGlvbih0cmFkZXJJZCwgZGF0ZXRpbWUsIHN0b2NrLCBwcmljZSwgc2hvcnQsIHBlcmNlbnRhZ2UpIHtcbiAgICB0aGlzLnRyYWRlcklkID0gdHJhZGVySWQ7XG4gICAgdGhpcy5kYXRldGltZSA9IGRhdGV0aW1lO1xuICAgIHRoaXMuc3RvY2sgPSBzdG9jaztcbiAgICB0aGlzLnByaWNlID0gcHJpY2U7XG4gICAgdGhpcy5zaG9ydCA9IHNob3J0O1xuICAgIHRoaXMucGVyY2VudGFnZSA9IHBlcmNlbnRhZ2U7XG59IiwiZnVuY3Rpb24gVHJhZGVyKG5hbWUsIHBvc2l0aW9ucykge1xuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgdGhpcy5wb3NpdGlvbnMgPSBwb3NpdGlvbnM7XG59IiwiZnVuY3Rpb24gVXNlcihuYW1lLCBhdmFpbGFibGUsIGludmVzdG1lbnRzKSB7XG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB0aGlzLmF2YWlsYWJsZSA9IGF2YWlsYWJsZTtcbiAgICB0aGlzLmludmVzdG1lbnRzID0gaW52ZXN0bWVudHNcbn0iLCJ2YXIgY29uZmlnID0ge1xuXG4gICAgdXJsOiBcIlwiLFxuICAgIGxvY2FsVXJsOiBcImh0dHA6Ly9sb2NhbGhvc3Q6NjMzNDIvcGxhdGZvcm0vc3JjL2RhdGEvZGVtby5qc29uXCJcblxufTsiLCJ2YXIgZm9ybWF0TW9uZXkgPSBmdW5jdGlvbihudW1iZXIpe1xuICAgIHJldHVybiBudW1iZXIudG9Mb2NhbGVTdHJpbmcodW5kZWZpbmVkLCB7bWluaW11bUZyYWN0aW9uRGlnaXRzOiAyfSk7XG59OyIsInZhciBQb3NpdGlvblNlcnZpY2UgPSAoZnVuY3Rpb24oKXtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgcmV0dXJuIHtcblxuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgeG1sSHR0cCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICAgICAgeG1sSHR0cC5vcGVuKFwiR0VUXCIsIGNvbmZpZy5sb2NhbFVybCwgZmFsc2UpO1xuICAgICAgICAgICAgeG1sSHR0cC5zZW5kKG51bGwpO1xuXG4gICAgICAgICAgICBpZih4bWxIdHRwLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKHhtbEh0dHAucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgICAgICB2YXIgcG9zaXRpb25zID0gW107XG5cbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwLCBsID0gZGF0YS5wb3NpdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvID0gZGF0YS5wb3NpdGlvbnNbaV07XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0gbmV3IFBvc2l0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgby50cmFkZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG8uZGF0ZXRpbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBvLnN0b2NrLFxuICAgICAgICAgICAgICAgICAgICAgICAgby5wcmljZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIG8uc2hvcnQsXG4gICAgICAgICAgICAgICAgICAgICAgICBvLnBlcmNlbnRhZ2VcbiAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbnMucHVzaChwb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHBvc2l0aW9ucztcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuICAgICAgICBnZXRCeVRyYWRlcklkOiBmdW5jdGlvbih0cmFkZXJJZCkge1xuXG4gICAgICAgICAgICB2YXIgeG1sSHR0cCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICAgICAgeG1sSHR0cC5vcGVuKFwiR0VUXCIsIGNvbmZpZy5sb2NhbFVybCwgZmFsc2UpO1xuICAgICAgICAgICAgeG1sSHR0cC5zZW5kKG51bGwpO1xuXG4gICAgICAgICAgICBpZih4bWxIdHRwLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKHhtbEh0dHAucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgICAgICB2YXIgcG9zaXRpb25zID0gW107XG5cbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwLCBsID0gZGF0YS5wb3NpdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvID0gZGF0YS5wb3NpdGlvbnNbaV07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYoby50cmFkZXJJZCA9PT0gdHJhZGVySWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb3NpdGlvbiA9IG5ldyBQb3NpdGlvbihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvLnRyYWRlcklkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8uZGF0ZXRpbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgby5zdG9jayxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvLnByaWNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG8uc2hvcnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgby5wZXJjZW50YWdlXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbnMucHVzaChwb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gcG9zaXRpb25zO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cblxuICAgIH07XG5cbn0pKCk7IiwidmFyIFRyYWRlclNlcnZpY2UgPSAoZnVuY3Rpb24oKXtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgcmV0dXJuIHtcblxuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgeG1sSHR0cCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICAgICAgeG1sSHR0cC5vcGVuKFwiR0VUXCIsIGNvbmZpZy5sb2NhbFVybCwgZmFsc2UpO1xuICAgICAgICAgICAgeG1sSHR0cC5zZW5kKG51bGwpO1xuXG4gICAgICAgICAgICBpZih4bWxIdHRwLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKHhtbEh0dHAucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgICAgICB2YXIgdHJhZGVycyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMCwgbCA9IGRhdGEudHJhZGVycy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG8gPSBkYXRhLnRyYWRlcnNbaV07XG4gICAgICAgICAgICAgICAgICAgIHZhciBwb3NpdGlvbnMgPSBQb3NpdGlvblNlcnZpY2UuZ2V0QnlUcmFkZXJJZChvLmlkKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgdCA9IG5ldyBUcmFkZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICBvLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbnNcbiAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICB0cmFkZXJzLnB1c2godCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYWRlcnM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcbiAgICAgICAgZ2V0QnlJZDogZnVuY3Rpb24oaWQpIHtcblxuICAgICAgICAgICAgdmFyIHhtbEh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgICAgIHhtbEh0dHAub3BlbihcIkdFVFwiLCBjb25maWcubG9jYWxVcmwsIGZhbHNlKTtcbiAgICAgICAgICAgIHhtbEh0dHAuc2VuZChudWxsKTtcblxuICAgICAgICAgICAgaWYoeG1sSHR0cC5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZSh4bWxIdHRwLnJlc3BvbnNlVGV4dCk7XG4gICAgICAgICAgICAgICAgdmFyIHRyYWRlcjtcblxuICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDAsIGwgPSBkYXRhLnRyYWRlcnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBvID0gZGF0YS50cmFkZXJzW2ldO1xuICAgICAgICAgICAgICAgICAgICBpZihvLmlkID09PSBpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBvc2l0aW9ucyA9IFBvc2l0aW9uU2VydmljZS5nZXRCeVRyYWRlcklkKG8uaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBUcmFkZXIoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgby5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uc1xuICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICB9O1xuXG59KSgpOyIsInZhciBVc2VyU2VydmljZSA9IChmdW5jdGlvbigpe1xuXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICByZXR1cm4ge1xuXG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIHZhciB4bWxIdHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgICAgICB4bWxIdHRwLm9wZW4oXCJHRVRcIiwgY29uZmlnLmxvY2FsVXJsLCBmYWxzZSk7XG4gICAgICAgICAgICB4bWxIdHRwLnNlbmQobnVsbCk7XG5cbiAgICAgICAgICAgIGlmKHhtbEh0dHAuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UoeG1sSHR0cC5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgICAgIHZhciBpbnZlc3RtZW50cyA9IFtdO1xuXG4gICAgICAgICAgICAgICAgZm9yKHZhciBpID0gMCwgbCA9IGRhdGEudXNlci5pbnZlc3RtZW50cy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG8gPSBkYXRhLnVzZXIuaW52ZXN0bWVudHNbaV07XG4gICAgICAgICAgICAgICAgICAgIHZhciB0cmFkZXIgPSBUcmFkZXJTZXJ2aWNlLmdldEJ5SWQoby50cmFkZXJJZCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGludmVzdG1lbnQgPSBuZXcgSW52ZXN0bWVudChcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyYWRlcixcbiAgICAgICAgICAgICAgICAgICAgICAgIG8uYW1vdW50XG4gICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgaW52ZXN0bWVudHMucHVzaChpbnZlc3RtZW50KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFVzZXIoXG4gICAgICAgICAgICAgICAgICAgIGRhdGEudXNlci5uYW1lLFxuICAgICAgICAgICAgICAgICAgICBkYXRhLnVzZXIuYXZhaWxhYmxlLFxuICAgICAgICAgICAgICAgICAgICBpbnZlc3RtZW50c1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgfTtcblxufSkoKTsiLCJ2YXIgVXNlclZpZXdNb2RlbCA9IHtcblxuICAgIHVzZXI6IG51bGwsXG4gICAgcmVuZGVyOiBmdW5jdGlvbihlbGVtZW50U2VsZWN0b3IpIHtcblxuICAgICAgICBpZighdGhpcy51c2VyIHx8IHR5cGVvZih0aGlzLnVzZXIpICE9PSBcIm9iamVjdFwiKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgTm9Vc2VyRXhjZXB0aW9uKFwiTm8gdXNlciBzZXRcIik7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZWxlbWVudFNlbGVjdG9yKTtcblxuICAgICAgICB2YXIgYm9iID0gXCI8c2VjdGlvbiBjbGFzcz0naW1nJz48L3NlY3Rpb24+XCI7XG4gICAgICAgIGJvYiArPSBcIjxoMj5cIiArIHRoaXMudXNlci5uYW1lICsgXCI8L2gyPlwiO1xuICAgICAgICBib2IgKz0gXCI8aDM+JmV1cm87IFwiICsgZm9ybWF0TW9uZXkodGhpcy51c2VyLmF2YWlsYWJsZSkgKyBcIjwvaDM+XCI7XG5cbiAgICAgICAgdmFyIGludmVzdGVkID0gMDtcbiAgICAgICAgdmFyIGluc3RvY2sgPSAwO1xuICAgICAgICB2YXIgYm9iZXR0ZSA9IFwiXCI7XG4gICAgICAgIGZvcih2YXIgaSA9IDAsIGwgPSB0aGlzLnVzZXIuaW52ZXN0bWVudHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgbyA9IHRoaXMudXNlci5pbnZlc3RtZW50c1tpXTtcbiAgICAgICAgICAgIGludmVzdGVkICs9IG8uYW1vdW50O1xuICAgICAgICAgICAgYm9iZXR0ZSArPSBcIjx0cmFkZXItcHJvZmlsZT48c2VjdGlvbiBjbGFzcz0naW1nJz48L3NlY3Rpb24+XCI7XG4gICAgICAgICAgICBib2JldHRlICs9IFwiPGgyPlwiICsgby50cmFkZXIubmFtZSArIFwiPC9oMj5cIjtcbiAgICAgICAgICAgIGJvYmV0dGUgKz0gXCI8aDM+JmV1cm87IFwiICsgZm9ybWF0TW9uZXkoby5hbW91bnQpICsgXCI8L2gzPlwiO1xuICAgICAgICAgICAgYm9iZXR0ZSArPSBcIjxkbD5cIjtcbiAgICAgICAgICAgIHZhciBzdG9jayA9IDA7XG4gICAgICAgICAgICBmb3IodmFyIGogPSAwLCBtID0gby50cmFkZXIucG9zaXRpb25zLmxlbmd0aDsgaiA8IG07IGorKykge1xuICAgICAgICAgICAgICAgIHZhciBwID0gby50cmFkZXIucG9zaXRpb25zW2pdO1xuICAgICAgICAgICAgICAgIHN0b2NrICs9IHAucGVyY2VudGFnZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGluc3RvY2sgKz0gby5hbW91bnQgLyAxMDAgKiBzdG9jaztcbiAgICAgICAgICAgIGJvYmV0dGUgKz0gXCI8ZHQ+VW5pbnZlc3RlZDo8L2R0PjxkZD48c3Bhbj4mZXVybzs8L3NwYW4+XCIgKyBmb3JtYXRNb25leShvLmFtb3VudCAvIDEwMCAqICgxMDAgLSBzdG9jaykpICsgXCI8L2RkPlwiO1xuICAgICAgICAgICAgYm9iZXR0ZSArPSBcIjxkdD5JbnZlc3RlZDo8L2R0PjxkZD48c3Bhbj4mZXVybzs8L3NwYW4+XCIgKyBmb3JtYXRNb25leShvLmFtb3VudCAvIDEwMCAqIHN0b2NrKSArIFwiPC9kZD5cIjtcbiAgICAgICAgICAgIGJvYmV0dGUgKz0gXCI8L3RyYWRlci1wcm9maWxlPlwiO1xuICAgICAgICB9XG5cbiAgICAgICAgYm9iICs9IFwiPGRsPlwiO1xuICAgICAgICBib2IgKz0gXCI8ZHQ+QXZhaWxhYmxlOjwvZHQ+PGRkPjxzcGFuPiZldXJvOzwvc3Bhbj5cIiArIGZvcm1hdE1vbmV5KHRoaXMudXNlci5hdmFpbGFibGUgLSBpbnZlc3RlZCkgKyBcIjwvZGQ+XCI7XG4gICAgICAgIGJvYiArPSBcIjxkdD5VbmludmVzdGVkOjwvZHQ+PGRkPjxzcGFuPiZldXJvOzwvc3Bhbj5cIiArIGZvcm1hdE1vbmV5KHRoaXMudXNlci5hdmFpbGFibGUgLSAodGhpcy51c2VyLmF2YWlsYWJsZSAtIGludmVzdGVkKSAtIGluc3RvY2spICsgXCI8L2RkPlwiO1xuICAgICAgICBib2IgKz0gXCI8ZHQ+SW52ZXN0ZWQ6PC9kdD48ZGQ+PHNwYW4+JmV1cm87PC9zcGFuPlwiICsgZm9ybWF0TW9uZXkoaW5zdG9jaykgKyBcIjwvZGQ+XCI7XG4gICAgICAgIGJvYiArPSBcIjwvZGw+XCI7XG5cbiAgICAgICAgZWxlbWVudC5pbm5lckhUTUwgPSBib2IgKyBib2JldHRlO1xuXG4gICAgfVxuXG59OyIsIihmdW5jdGlvbigpIHtcblxuICAgIFVzZXJWaWV3TW9kZWwudXNlciA9IFVzZXJTZXJ2aWNlLmdldCgpO1xuICAgIFVzZXJWaWV3TW9kZWwucmVuZGVyKFwidXNlci1wcm9maWxlXCIpO1xuXG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
